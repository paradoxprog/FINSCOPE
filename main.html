<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FINSCOPE - Financial Dashboard</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #f8fafc; /* Very light slate background */
            color: #1e293b;
        }
        
        /* Modern Card Style */
        .dashboard-card {
            background-color: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: 1rem; /* rounded-2xl */
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1); /* shadow-sm */
            transition: box-shadow 0.3s ease;
        }
        
        .dashboard-card:hover {
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); /* shadow-md */
        }

        .gradient-text {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Custom Scrollbar for Chat */
        .chat-scroll::-webkit-scrollbar {
            width: 6px;
        }
        .chat-scroll::-webkit-scrollbar-track {
            background: transparent; 
        }
        .chat-scroll::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 10px;
        }
        .chat-scroll::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }

        /* Loader */
        .loader {
            border: 3px solid #f1f5f9;
            border-radius: 50%;
            border-top: 3px solid #6366f1;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* Input Field Focus Transition */
        input, textarea {
            transition: all 0.2s ease-in-out;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <header class="sticky top-0 z-50 bg-white/80 backdrop-blur-md border-b border-slate-200">
        <div class="container mx-auto px-6 py-3 flex justify-between items-center">
            
            <a href="#" class="flex items-center gap-3">
                <img src="logo.jpg" alt="FINSCOPE Logo" class="h-10 w-10 rounded-lg shadow-sm object-cover hover:scale-105 transition-transform">
                <span class="text-xl font-bold tracking-tight text-slate-800">FIN<span class="text-indigo-600">SCOPE</span></span>
            </a>

            <div id="user-nav" class="hidden items-center space-x-6">
                 <div class="flex items-center gap-2">
                    <div class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600 font-bold text-xs">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                    </div>
                    <p id="user-greeting" class="text-sm font-semibold text-slate-600 hidden sm:block"></p>
                 </div>
                 <button id="logout-btn" class="text-sm font-medium text-slate-500 hover:text-red-600 transition-colors">
                    Sign Out
                </button>
            </div>
        </div>
    </header>

    <main class="flex-grow container mx-auto px-4 py-8 space-y-8">
        
        <div class="flex flex-col md:flex-row justify-between items-end gap-4 mb-6">
            <div>
                <h1 class="text-3xl font-bold text-slate-900">Financial Dashboard</h1>
                <p class="text-slate-500 mt-1">Manage your profile and consult your AI Twin.</p>
            </div>
            <div class="flex items-center gap-2 px-3 py-1.5 bg-indigo-50 text-indigo-700 rounded-full text-xs font-semibold border border-indigo-100">
                <span class="relative flex h-2 w-2">
                  <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-indigo-400 opacity-75"></span>
                  <span class="relative inline-flex rounded-full h-2 w-2 bg-indigo-500"></span>
                </span>
                AI Twin Active
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
            
            <div class="lg:col-span-7 space-y-6">
                
                <section id="financial-input" class="dashboard-card p-6 md:p-8">
                    <div class="flex items-center gap-3 mb-6 border-b border-slate-100 pb-4">
                        <div class="p-2 bg-indigo-50 rounded-lg">
                            <svg class="w-5 h-5 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V8a2 2 0 00-2-2h-5m-4 0V5a2 2 0 114 0v1m-4 0a2 2 0 104 0m-5 8a2 2 0 100-4 2 2 0 000 4zm0 0c1.306 0 2.417.835 2.83 2M9 14a3.001 3.001 0 00-2.83 2M15 11h3m-3 4h2"></path></svg>
                        </div>
                        <h2 class="text-lg font-bold text-slate-800">Current Financial Status</h2>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                        <div class="space-y-1.5">
                            <label class="text-xs font-bold uppercase tracking-wide text-slate-400">Monthly Net Income</label>
                            <div class="relative group">
                                <span class="absolute left-3 top-2.5 text-slate-400 font-medium">â‚¹</span>
                                <input type="number" id="monthlyIncome" class="w-full pl-8 pr-4 py-2 bg-slate-50 border border-slate-200 rounded-lg focus:bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none font-semibold text-slate-700" placeholder="50000">
                            </div>
                        </div>
                        <div class="space-y-1.5">
                            <label class="text-xs font-bold uppercase tracking-wide text-slate-400">Current Savings</label>
                            <div class="relative group">
                                <span class="absolute left-3 top-2.5 text-slate-400 font-medium">â‚¹</span>
                                <input type="number" id="currentSavings" class="w-full pl-8 pr-4 py-2 bg-slate-50 border border-slate-200 rounded-lg focus:bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none font-semibold text-slate-700" placeholder="200000">
                            </div>
                        </div>
                        
                        <div class="md:col-span-2 space-y-2">
                            <label class="text-xs font-bold uppercase tracking-wide text-slate-400">Monthly Expenses</label>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                <input type="number" id="housing" class="p-2 bg-slate-50 border border-slate-200 rounded-lg text-sm focus:bg-white focus:ring-indigo-500 focus:border-indigo-500 outline-none" placeholder="Housing â‚¹">
                                <input type="number" id="food" class="p-2 bg-slate-50 border border-slate-200 rounded-lg text-sm focus:bg-white focus:ring-indigo-500 focus:border-indigo-500 outline-none" placeholder="Food â‚¹">
                                <input type="number" id="transport" class="p-2 bg-slate-50 border border-slate-200 rounded-lg text-sm focus:bg-white focus:ring-indigo-500 focus:border-indigo-500 outline-none" placeholder="Transport â‚¹">
                                <input type="number" id="other" class="p-2 bg-slate-50 border border-slate-200 rounded-lg text-sm focus:bg-white focus:ring-indigo-500 focus:border-indigo-500 outline-none" placeholder="Other â‚¹">
                            </div>
                        </div>

                        <div class="md:col-span-2 space-y-1.5">
                            <label class="text-xs font-bold uppercase tracking-wide text-slate-400">Financial Goals</label>
                            <textarea id="financialGoals" rows="2" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-lg focus:bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none text-sm text-slate-700" placeholder="e.g. Save for a house down payment in 3 years..."></textarea>
                        </div>
                    </div>

                    <button id="analyzeBtn" class="mt-6 w-full py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-semibold shadow-md hover:shadow-lg transition-all flex justify-center items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path></svg>
                        Analyze & Train Twin
                    </button>

                    <div id="analysisResult" class="mt-6 p-4 bg-indigo-50 border border-indigo-100 rounded-lg text-sm text-slate-700 hidden opacity-0 transition-all duration-500"></div>
                </section>

                <section id="simulation" class="dashboard-card p-6 md:p-8">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="p-2 bg-emerald-50 rounded-lg">
                            <svg class="w-5 h-5 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
                        </div>
                        <h2 class="text-lg font-bold text-slate-800">Scenario Simulator</h2>
                    </div>

                    <div class="bg-slate-50 p-1.5 rounded-lg border border-slate-200 flex flex-col sm:flex-row gap-2">
                        <input type="text" id="scenarioInput" class="flex-grow bg-transparent px-3 py-2 outline-none text-slate-800 placeholder-slate-400 text-sm" placeholder="e.g. What if I invest â‚¹5k/month in mutual funds?" disabled>
                        <button id="simulateBtn" class="bg-emerald-600 hover:bg-emerald-700 text-white font-semibold px-5 py-2 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed text-sm shadow-sm">
                            Simulate
                        </button>
                    </div>
                    
                    <div id="simulationResult" class="mt-4 p-4 bg-white rounded-lg border border-slate-100 shadow-inner min-h-[60px] text-sm text-slate-600">
                        <span class="italic text-slate-400">Run the profile analysis above to unlock simulations.</span>
                    </div>
                </section>
            </div>

            <div class="lg:col-span-5">
                <section id="chat" class="dashboard-card h-[650px] flex flex-col relative overflow-hidden">
                    
                    <div class="p-4 border-b border-slate-100 bg-white flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="relative">
                                <div class="w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white font-bold shadow-md">
                                    AI
                                </div>
                                <div class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-white rounded-full"></div>
                            </div>
                            <div>
                                <h3 class="font-bold text-slate-800 text-sm">FinScope Twin</h3>
                                <p class="text-[10px] uppercase tracking-wider text-indigo-600 font-bold">Online</p>
                            </div>
                        </div>
                        <button class="text-slate-400 hover:text-slate-600">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"></path></svg>
                        </button>
                    </div>

                    <div id="chatBox" class="flex-grow p-4 overflow-y-auto chat-scroll bg-slate-50 space-y-4">
                        <div class="flex justify-start">
                            <div class="bg-white border border-slate-200 text-slate-700 px-4 py-3 rounded-2xl rounded-tl-none shadow-sm max-w-[85%] text-sm">
                                ðŸ‘‹ <strong>Hello!</strong> I'm your Financial Twin. Fill out the profile on the left and click analyze. I'll learn from your data to answer your questions!
                            </div>
                        </div>
                    </div>

                    <div class="p-4 bg-white border-t border-slate-100">
                        <div class="relative flex items-center">
                            <input type="text" id="chatInput" placeholder="Ask a financial question..." class="w-full pl-4 pr-12 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none text-sm transition-all shadow-sm" disabled>
                            <button id="sendChatBtn" class="absolute right-2 p-1.5 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                                <svg class="w-5 h-5 transform rotate-90" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg>
                            </button>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        // --- CONFIGURATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyD6iB5gh_4arp0UkqILCFRgXq4KRFmDpAY",
            authDomain: "finscope-282b3.firebaseapp.com",
            projectId: "finscope-282b3",
            storageBucket: "finscope-282b3.firebasestorage.app",
            messagingSenderId: "838937656151",
            appId: "1:838937656151:web:85cfddd9dd86b39d4cdc12",
            measurementId: "G-R8GE51ZT8J"
        };
        
        // --- INITIALIZATION ---
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // --- DOM ELEMENTS ---
        const userNav = document.getElementById('user-nav');
        const userGreeting = document.getElementById('user-greeting');
        const logoutBtn = document.getElementById('logout-btn');
        
        const monthlyIncome = document.getElementById('monthlyIncome');
        const currentSavings = document.getElementById('currentSavings');
        const housing = document.getElementById('housing');
        const food = document.getElementById('food');
        const transport = document.getElementById('transport');
        const other = document.getElementById('other');
        const financialGoals = document.getElementById('financialGoals');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const analysisResult = document.getElementById('analysisResult');

        const scenarioInput = document.getElementById('scenarioInput');
        const simulateBtn = document.getElementById('simulateBtn');
        const simulationResult = document.getElementById('simulationResult');

        const chatBox = document.getElementById('chatBox');
        const chatInput = document.getElementById('chatInput');
        const sendChatBtn = document.getElementById('sendChatBtn');

        // --- STATE ---
        let userFinancialProfile = null;
        let chatHistory = [];

        // --- AUTH ---
        onAuthStateChanged(auth, (user) => {
            if (user) {
                userNav.classList.remove('hidden');
                userNav.classList.add('flex');
                userGreeting.textContent = `Hi, ${user.displayName ? user.displayName.split(' ')[0] : 'User'}`;
            } else {
                // If this is the main dashboard, redirect to login is usually handled here
                // window.location.href = './index.html'; 
            }
        });

        logoutBtn.addEventListener('click', () => {
            signOut(auth).catch((error) => console.error('Sign Out Error', error));
        });

        // --- SECURE API HELPER ---
        async function callGemini(prompt, retries = 3, delay = 1000) {
            const API_URL = '/api/gemini'; 

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });

                if (!response.ok) {
                    if (response.status === 429 && retries > 0) { 
                        await new Promise(res => setTimeout(res, delay));
                        return callGemini(prompt, retries - 1, delay * 2); 
                    }
                    const errorData = await response.json();
                    throw new Error(errorData.error || `API call failed: ${response.status}`);
                }

                const data = await response.json();
                if (data.candidates && data.candidates.length > 0) {
                    let rawText = data.candidates[0].content.parts[0].text;
                    let cleanedText = rawText.trim();
                    if (cleanedText.startsWith('```html')) {
                        cleanedText = cleanedText.substring(7);
                        if (cleanedText.endsWith('```')) cleanedText = cleanedText.slice(0, -3);
                    } else if (cleanedText.toLowerCase().startsWith('html')) {
                        cleanedText = cleanedText.substring(4);
                    }
                    return cleanedText.trim();
                } else {
                    return "I didn't quite get that. Could you try rephrasing?";
                }
            } catch (error) {
                console.error("API Error:", error);
                if (retries > 0) {
                    await new Promise(res => setTimeout(res, delay));
                    return callGemini(prompt, retries - 1, delay * 2);
                }
                return `Server Error: ${error.message}`;
            }
        }
        
        // --- LOGIC ---

        // 1. Analyze Profile
        analyzeBtn.addEventListener('click', async () => {
            const profile = {
                income: monthlyIncome.value,
                savings: currentSavings.value,
                expenses: {
                    housing: housing.value,
                    food: food.value,
                    transport: transport.value,
                    other: other.value
                },
                goals: financialGoals.value
            };

            if (!profile.income || !profile.savings || !profile.goals) {
                analysisResult.innerHTML = `<p class="text-red-500 font-semibold flex items-center gap-2"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg> Please fill in Income, Savings, and Goals.</p>`;
                analysisResult.classList.remove('hidden');
                analysisResult.style.opacity = "1";
                return;
            }

            userFinancialProfile = profile;
            analysisResult.classList.remove('hidden');
            analysisResult.style.opacity = "1";
            analysisResult.innerHTML = '<div class="loader"></div><p class="text-center mt-2 text-indigo-600 animate-pulse font-medium">Building your Financial Twin...</p>';
            analyzeBtn.disabled = true;
            analyzeBtn.classList.add('opacity-75', 'cursor-wait');

            const prompt = `
                Analyze financial profile (INR):
                - Monthly Income: â‚¹${profile.income}
                - Savings: â‚¹${profile.savings}
                - Expenses: Housing: ${profile.expenses.housing}, Food: ${profile.expenses.food}, Transport: ${profile.expenses.transport}, Other: ${profile.expenses.other}
                - Goals: "${profile.goals}"

                Provide:
                1. A 2-sentence summary of financial health.
                2. 3 Actionable Bullet points using HTML (<ul>, <li>, <strong>).
            `;

            const result = await callGemini(prompt);
            analysisResult.innerHTML = result;
            analyzeBtn.disabled = false;
            analyzeBtn.classList.remove('opacity-75', 'cursor-wait');
            analyzeBtn.innerText = "Update Profile Analysis";

            if (!result.toLowerCase().includes('error')) {
                // Enable other sections
                scenarioInput.disabled = false;
                simulateBtn.disabled = false;
                chatInput.disabled = false;
                sendChatBtn.disabled = false;
                
                // Add initial AI message
                addMessageToChatbox("Analysis complete! I've studied your financial profile. You can now ask me specifics or run simulations.", 'ai');
            }
        });

        // 2. Simulate
        simulateBtn.addEventListener('click', async () => {
            const scenario = scenarioInput.value;
            if (!scenario || !userFinancialProfile) return;

            simulationResult.innerHTML = '<div class="loader"></div>';
            simulateBtn.disabled = true;

            const prompt = `
                Context: User earns â‚¹${userFinancialProfile.income}/mo, has â‚¹${userFinancialProfile.savings} saved.
                Goal: "${userFinancialProfile.goals}"
                
                Scenario to Simulate: "${scenario}".
                
                Output: A brief, direct analysis of the impact in simple HTML. Use bolding for key numbers.
            `;
            
            const result = await callGemini(prompt);
            simulationResult.innerHTML = result;
            simulateBtn.disabled = false;
        });

        // 3. Chat
        const handleSendChat = async () => {
            const message = chatInput.value.trim();
            if (!message || !userFinancialProfile) return;

            addMessageToChatbox(message, 'user');
            chatInput.value = '';
            sendChatBtn.disabled = true;

            chatHistory.push({ role: 'user', parts: [{ text: message }] });

            // Create placeholder for AI response
            const typingId = addMessageToChatbox('<div class="flex gap-1 items-center h-5"><div class="w-1.5 h-1.5 bg-slate-400 rounded-full animate-bounce"></div><div class="w-1.5 h-1.5 bg-slate-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></div><div class="w-1.5 h-1.5 bg-slate-400 rounded-full animate-bounce" style="animation-delay: 0.4s"></div></div>', 'ai');

            const prompt = `
                Act as a "Financial Twin" advisor.
                Profile: Income â‚¹${userFinancialProfile.income}, Savings â‚¹${userFinancialProfile.savings}, Goal "${userFinancialProfile.goals}".
                History: ${chatHistory.map(msg => `${msg.role}: ${msg.parts[0].text}`).join('\n')}
                
                Respond to user in helpful, short HTML format. Keep it conversational.
            `;

            const result = await callGemini(prompt);
            
            // Replace typing indicator with actual message
            const bubble = document.getElementById(typingId);
            if(bubble) bubble.innerHTML = result;

            chatHistory.push({ role: 'model', parts: [{ text: result }] });
            sendChatBtn.disabled = false;

            if (chatHistory.length > 10) chatHistory = chatHistory.slice(-10);
        };

        sendChatBtn.addEventListener('click', handleSendChat);
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') handleSendChat();
        });

        function addMessageToChatbox(text, sender) {
            const messageWrapper = document.createElement('div');
            const messageBubble = document.createElement('div');
            const id = 'msg-' + Date.now();
            
            messageWrapper.classList.add('flex', 'mb-4'); 
            
            if (sender === 'user') {
                messageWrapper.classList.add('justify-end');
                messageBubble.classList.add('bg-indigo-600', 'text-white', 'px-4', 'py-3', 'rounded-2xl', 'rounded-tr-none', 'max-w-[85%]', 'shadow-md', 'text-sm');
            } else {
                messageWrapper.classList.add('justify-start');
                messageBubble.classList.add('bg-white', 'border', 'border-slate-200', 'text-slate-700', 'px-4', 'py-3', 'rounded-2xl', 'rounded-tl-none', 'max-w-[85%]', 'shadow-sm', 'text-sm');
            }
            
            messageBubble.id = id;
            messageBubble.innerHTML = text;
            messageWrapper.appendChild(messageBubble);
            chatBox.appendChild(messageWrapper);
            chatBox.scrollTop = chatBox.scrollHeight;
            return id;
        }

    </script>
</body>
</html>
